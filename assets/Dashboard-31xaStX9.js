import{c as k,j as e,r as M,L as P,B as _,U as q}from"./index-CX_Kz4I_.js";import{u as b}from"./useQuery-BEywYAK-.js";import{C as d}from"./Card-D8xCTCOE.js";import{C as N}from"./ChartContainer-CIGup35M.js";import{g as z,a as L,b as R}from"./index-C-ESXXEL.js";import{C as B,M as S}from"./map-pin-D4S9fSNx.js";import{f as p,p as g}from"./pt-BR-BnWYOt86.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=k("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=k("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),A=({status:m,label:u,pulsing:s=!1})=>{const f=c=>{switch(c){case"online":return"bg-green-500";case"offline":return"bg-gray-400";case"away":return"bg-yellow-500";case"busy":return"bg-red-500";default:return"bg-gray-400"}},n=c=>{if(u)return u;switch(c){case"online":return"Online";case"offline":return"Offline";case"away":return"Ausente";case"busy":return"Ocupado";default:return"Desconhecido"}};return e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx("div",{className:`h-2.5 w-2.5 rounded-full ${f(m)} ${s?"animate-pulse-slow":""}`}),e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:n(m)})]})},G=()=>{var v,w,D;const[m,u]=M.useState("today"),{data:s,isLoading:f}=b({queryKey:["dashboardSummary"],queryFn:z}),{data:n,isLoading:c}=b({queryKey:["researchers"],queryFn:L}),{data:l,isLoading:F}=b({queryKey:["surveys"],queryFn:()=>R()}),o=(()=>{if(!l)return null;const t=new Array(7).fill(0).map((a,j)=>{const y=new Date;return y.setDate(y.getDate()-j),p(y,"dd/MM",{locale:g})}).reverse(),r=t.map(a=>l.filter(j=>p(new Date(j.data_hora),"dd/MM",{locale:g})===a).length),i={"18-24":0,"25-34":0,"35-44":0,"45-54":0,"55+":0};l.forEach(a=>{a.idade<25?i["18-24"]++:a.idade<35?i["25-34"]++:a.idade<45?i["35-44"]++:a.idade<55?i["45-54"]++:i["55+"]++});const h={"Muito Insatisfeito":0,Insatisfeito:0,Neutro:0,Satisfeito:0,"Muito Satisfeito":0};return l.forEach(a=>{a.satisfacao_servicos&&h[a.satisfacao_servicos]!==void 0&&h[a.satisfacao_servicos]++}),{surveysByDate:{labels:t,datasets:[{label:"Pesquisas Realizadas",data:r,backgroundColor:"#1E40AF"}]},demographics:{labels:Object.keys(i),datasets:[{label:"Distribuição por Idade",data:Object.values(i),backgroundColor:["#1E40AF","#2563EB","#3B82F6","#60A5FA","#93C5FD"]}]},satisfaction:{labels:Object.keys(h),datasets:[{label:"Nível de Satisfação",data:Object.values(h),backgroundColor:"#0F766E"}]}}})(),x=n==null?void 0:n.filter(t=>new Date(t.ultimo_acesso)>new Date(Date.now()-24*60*60*1e3)).sort((t,r)=>new Date(r.ultimo_acesso).getTime()-new Date(t.ultimo_acesso).getTime()).slice(0,5);return f||c||F?e.jsx(P,{size:"lg"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("div",{className:"mt-2 md:mt-0 flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-2",children:"Filtrar por:"}),e.jsxs("select",{value:m,onChange:t=>u(t.target.value),className:"text-sm border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"today",children:"Hoje"}),e.jsx("option",{value:"yesterday",children:"Ontem"}),e.jsx("option",{value:"week",children:"Esta Semana"}),e.jsx("option",{value:"month",children:"Este Mês"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(d,{className:"hover:border-blue-500",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total de Pesquisas"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:(s==null?void 0:s.totalSurveys)||0})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(_,{size:24,className:"text-blue-900"})})]}),e.jsx("div",{className:"mt-4 flex items-center",children:e.jsxs("span",{className:"text-xs font-medium text-green-600 bg-green-100 px-2 py-0.5 rounded-full",children:["+",(s==null?void 0:s.surveysToday)||0," hoje"]})})]}),e.jsxs(d,{className:"hover:border-teal-500",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pesquisadores Ativos"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:(s==null?void 0:s.activeResearchers)||0})]}),e.jsx("div",{className:"p-3 bg-teal-100 rounded-full",children:e.jsx(q,{size:24,className:"text-teal-700"})})]}),e.jsx("div",{className:"mt-4 flex items-center",children:e.jsxs("span",{className:"text-xs font-medium text-gray-600",children:[(s==null?void 0:s.totalResearchers)||0," pesquisadores no total"]})})]}),e.jsxs(d,{className:"hover:border-amber-500",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pesquisas Hoje"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:(s==null?void 0:s.surveysToday)||0})]}),e.jsx("div",{className:"p-3 bg-amber-100 rounded-full",children:e.jsx(B,{size:24,className:"text-amber-600"})})]}),e.jsx("div",{className:"mt-4 flex items-center",children:e.jsxs("span",{className:"text-xs font-medium text-amber-600 bg-amber-100 px-2 py-0.5 rounded-full",children:["Última há ",(v=s==null?void 0:s.recentSurveys)!=null&&v[0]?p(new Date(s.recentSurveys[0].data_hora),"mm",{locale:g}):"0"," minutos"]})})]}),e.jsxs(d,{className:"hover:border-indigo-500",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Regiões Mapeadas"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:l?new Set(l.map(t=>`${t.latitude.toFixed(1)},${t.longitude.toFixed(1)}`)).size:0})]}),e.jsx("div",{className:"p-3 bg-indigo-100 rounded-full",children:e.jsx(S,{size:24,className:"text-indigo-600"})})]}),e.jsx("div",{className:"mt-4 flex items-center",children:e.jsx("span",{className:"text-xs font-medium text-indigo-600 bg-indigo-100 px-2 py-0.5 rounded-full",children:"Cobertura ativa"})})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:o&&e.jsxs(e.Fragment,{children:[e.jsx(N,{title:"Pesquisas por Data",subtitle:"Últimos 7 dias",type:"bar",data:o.surveysByDate,action:e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-800",children:"Ver Detalhes"})}),e.jsx(N,{title:"Distribuição Demográfica",subtitle:"Por Idade",type:"doughnut",data:o.demographics,action:e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-800",children:"Ver Mais"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:o&&e.jsx(N,{title:"Nível de Satisfação com Serviços Públicos",type:"line",data:o.satisfaction})}),e.jsxs(d,{title:"Atividade dos Pesquisadores",className:"lg:col-span-1",children:[e.jsxs("div",{className:"space-y-4",children:[x==null?void 0:x.map(t=>{var r;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(q,{size:16,className:"text-blue-900"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:((r=t.usuario)==null?void 0:r.nome)||`Pesquisador ${t.id}`}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.ultimo_acesso).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsx(A,{status:new Date(t.ultimo_acesso)>new Date(Date.now()-30*60*1e3)?"online":"offline",pulsing:new Date(t.ultimo_acesso)>new Date(Date.now()-15*60*1e3)})]},t.id)}),(!x||x.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-4",children:[e.jsx(E,{size:24,className:"text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum pesquisador ativo nas últimas 24 horas."})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("a",{href:"/researchers",className:"flex items-center justify-center text-sm font-medium text-blue-600 hover:text-blue-800",children:[e.jsx("span",{children:"Ver todos os pesquisadores"}),e.jsx(C,{size:16,className:"ml-1"})]})})]})]}),e.jsxs(d,{title:"Pesquisas Recentes",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pesquisador"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data/Hora"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Localização"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Perfil"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(w=s==null?void 0:s.recentSurveys)==null?void 0:w.map(t=>{var r,i;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",t.id]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:((i=(r=t.pesquisador)==null?void 0:r.usuario)==null?void 0:i.nome)||`Pesquisador ${t.pesquisador_id}`}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:p(new Date(t.data_hora),"dd/MM/yyyy HH:mm",{locale:g})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{size:14,className:"text-gray-400 mr-1"}),e.jsxs("span",{children:[t.latitude.toFixed(4),", ",t.longitude.toFixed(4)]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:[t.sexo,", ",t.idade," anos"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-900 mr-3",children:"Detalhes"})})]},t.id)})})]})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Mostrando ",((D=s==null?void 0:s.recentSurveys)==null?void 0:D.length)||0," de ",(s==null?void 0:s.totalSurveys)||0," pesquisas"]}),e.jsxs("button",{className:"text-sm flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx("span",{children:"Ver todas as pesquisas"}),e.jsx(C,{size:16,className:"ml-1"})]})]})]})]})};export{G as default};
